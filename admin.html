<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel Admin - Parque Angostura</title>
  <link rel="stylesheet" href="style.css">
  <script>
    // Función para validar RUT chileno
    function validarRut(rut) {
      if (!/^[0-9]{7,8}-[0-9kK]$/.test(rut)) return false;
      const rutLimpio = rut.replace(/\./g,'').replace('-','');
      const dv = rutLimpio.slice(-1).toLowerCase();
      const rutNum = parseInt(rutLimpio.slice(0, -1));
      
      let suma = 0;
      let multiplicador = 2;
      for (let i = rutNum.toString().split('').reverse().join(''); i; i = Math.floor(i/10)) {
        suma += (i % 10) * multiplicador;
        multiplicador = multiplicador === 7 ? 2 : multiplicador + 1;
      }
      
      const dvEsperado = 11 - (suma % 11);
      const dvCalculado = dvEsperado === 11 ? '0' : dvEsperado === 10 ? 'k' : dvEsperado.toString();
      return dv === dvCalculado;
    }

    // Base de datos simple de funcionarios autorizados
    const funcionariosAutorizados = {
      '12345678-9': 'clave123',
      '98765432-1': 'clave456'
    };

    function iniciarSesion() {
      const rut = document.getElementById("rut").value.trim();
      const password = document.getElementById("password").value;

      if (!validarRut(rut)) {
        alert("⚠️ RUT inválido. Formato requerido: 12345678-9");
        return;
      }

      if (funcionariosAutorizados[rut] !== password) {
        alert("⛔ Credenciales incorrectas. Acceso denegado.");
        return;
      }

      // Guardar sesión
      sessionStorage.setItem('funcionarioRut', rut);
      
      // Mostrar panel de administración
      document.getElementById('loginForm').style.display = 'none';
      document.getElementById('adminPanel').style.display = 'block';
      document.getElementById('funcionarioActual').textContent = rut;
    }

    function cerrarSesion() {
      sessionStorage.removeItem('funcionarioRut');
      document.getElementById('loginForm').style.display = 'block';
      document.getElementById('adminPanel').style.display = 'none';
      document.getElementById('loginForm').reset();
    }

    function guardarEspecie() {
      const nombre = document.getElementById("nombreEspecie").value.trim();
      const descripcion = document.getElementById("descripcionEspecie").value.trim();

      if (!nombre || !descripcion) {
        alert("⚠️ Completa todos los campos antes de guardar.");
        return;
      }

      const rutFuncionario = sessionStorage.getItem('funcionarioRut');
      alert(`✅ Especie "${nombre}" guardada correctamente por funcionario ${rutFuncionario}`);
      document.getElementById("especieForm").reset();
    }

    // Verificar sesión al cargar la página
    window.onload = function() {
      const rutFuncionario = sessionStorage.getItem('funcionarioRut');
      if (rutFuncionario) {
        document.getElementById('loginForm').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        document.getElementById('funcionarioActual').textContent = rutFuncionario;
      }
    }
  </script>
</head>
<body>
  <header>
    <h1>Panel de Administración</h1>
    <nav>
      <a href="index.html">Inicio</a>
      <a href="info.html">Información</a>
      <a href="trivia.html">Trivia</a>
      <a href="admin.html" class="active">Admin</a>
    </nav>
  </header>

  <main>
    <h2>Panel Admin (acceso restringido)</h2>
    
    <!-- Formulario de login -->
    <form id="loginForm" autocomplete="off">
      <p class="note">Acceso exclusivo para funcionarios autorizados</p>
      <label for="rut">RUT de funcionario:</label>
      <input type="text" id="rut" placeholder="Ej: 12345678-9" required>

      <label for="password">Contraseña:</label>
      <input type="password" id="password" required>

      <button type="button" onclick="iniciarSesion()">Iniciar Sesión</button>
    </form>

    <!-- Panel de administración (inicialmente oculto) -->
    <div id="adminPanel" style="display: none;">
      <div class="admin-header">
        <p>Funcionario: <span id="funcionarioActual"></span></p>
        <button type="button" onclick="cerrarSesion()" class="logout-btn">Cerrar Sesión</button>
      </div>

      <form id="especieForm" autocomplete="off">
        <h3>Agregar Nueva Especie</h3>
        <label for="nombreEspecie">Nombre de la especie:</label>
        <input type="text" id="nombreEspecie" placeholder="Ej: Coihue" required>

        <label for="descripcionEspecie">Descripción:</label>
        <textarea id="descripcionEspecie" rows="4" placeholder="Breve descripción..." required></textarea>

        <button type="button" onclick="guardarEspecie()">Guardar Especie</button>
      </form>
    </div>
  </main>

  <style>
    .admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding: 10px;
      background-color: #f5f5f5;
      border-radius: 4px;
    }
    .admin-header p {
      margin: 0;
      font-weight: bold;
    }
    .logout-btn {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 4px;
      cursor: pointer;
    }
    .logout-btn:hover {
      background-color: #c82333;
    }
  </style>

  <footer>
    <p>© 2025 Parque Angostura</p>
  </footer>
</body>
</html>
